<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Accessibility Mode - Voice Only</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
      padding: 20px;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    h1 {
      color: #2c3e50;
      font-size: 2.5rem;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    
    .subtitle {
      color: #666;
      font-size: 1.1rem;
    }
    
    .status-card {
      background: linear-gradient(135deg, #e8f4fc 0%, #d4edda 100%);
      padding: 25px;
      margin: 25px 0;
      border-radius: 15px;
      border-left: 6px solid #3498db;
      text-align: center;
    }
    
    #status {
      font-size: 1.2rem;
      font-weight: 600;
      color: #2c3e50;
      min-height: 28px;
    }
    
    .controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      margin: 25px 0;
    }
    
    button {
      padding: 15px 30px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 200px;
      justify-content: center;
    }
    
    #startBtn {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      color: white;
    }
    
    #startBtn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(72, 187, 120, 0.3);
    }
    
    #stopBtn {
      background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
      color: white;
    }
    
    #stopBtn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(245, 101, 101, 0.3);
    }
    
    #helpBtn {
      background: linear-gradient(135deg, #667eea 0%, #5a67d8 100%);
      color: white;
    }
    
    #helpBtn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    
    button:disabled {
      background: #a0aec0 !important;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    
    .command-section {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 15px;
      margin: 30px 0;
      border: 2px solid #e9ecef;
    }
    
    .command-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .command-item {
      background: white;
      padding: 15px;
      border-radius: 10px;
      border-left: 4px solid #3498db;
    }
    
    .command-keyword {
      color: #2c3e50;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .command-desc {
      color: #666;
      font-size: 14px;
    }
    
    .content-area {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 25px;
      margin: 25px 0;
      min-height: 200px;
      overflow-y: auto;
    }
    
    .content-label {
      color: #2c3e50;
      font-weight: 600;
      margin-bottom: 15px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    #currentText {
      font-size: 18px;
      line-height: 1.6;
      min-height: 120px;
    }
    
    .predictions-section {
      background: #f0f7ff;
      border-radius: 12px;
      padding: 25px;
      margin: 25px 0;
    }
    
    .prediction-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .prediction-item {
      background: white;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .prediction-item:hover {
      background: #e8f4fc;
      border-color: #3498db;
      transform: translateY(-2px);
    }
    
    .prediction-type {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 5px;
    }
    
    .prediction-text {
      font-size: 16px;
      font-weight: 500;
      color: #2c3e50;
    }
    
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 15px;
    }
    
    .feature-item {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid #e9ecef;
    }
    
    .feature-icon {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    
    .feature-title {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 5px;
    }
    
    .feature-desc {
      color: #666;
      font-size: 14px;
    }
    
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #48bb78;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 2rem;
        flex-direction: column;
        gap: 10px;
      }
      
      button {
        min-width: 100%;
      }
      
      .command-grid {
        grid-template-columns: 1fr;
      }
      
      .prediction-grid {
        grid-template-columns: 1fr;
      }
    }
    
    /* Voice activity indicator */
    .voice-activity {
      width: 20px;
      height: 20px;
      background: #48bb78;
      border-radius: 50%;
      animation: pulse 2s infinite;
      display: none;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.2);
        opacity: 0.7;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>
        <span>üé§ Accessibility Mode</span>
        <div class="voice-activity" id="voiceActivity"></div>
      </h1>
      <p class="subtitle">Designed for visually impaired, elderly, and hands-free users</p>
    </header>
    
    <div class="status-card">
      <div id="status">‚úÖ Ready. Say "start typing" or click "Start Voice Mode"</div>
    </div>
    
    <div class="controls">
      <button id="startBtn">üé§ Start Voice Mode</button>
      <button id="stopBtn" disabled>‚èπÔ∏è Stop Listening</button>
      <button id="helpBtn">‚ùì Voice Help</button>
    </div>
    
    <div class="command-section">
      <h2>üéØ Voice Commands</h2>
      <p style="color: #666; margin-top: 10px;">Say any of these commands during voice mode:</p>
      
      <div class="command-grid">
        <div class="command-item">
          <div class="command-keyword">"Start typing"</div>
          <div class="command-desc">Begin dictation mode</div>
        </div>
        <div class="command-item">
          <div class="command-keyword">"Predict next words"</div>
          <div class="command-desc">Get word predictions</div>
        </div>
        <div class="command-item">
          <div class="command-keyword">"Complete sentence"</div>
          <div class="command-desc">Get sentence completions</div>
        </div>
        <div class="command-item">
          <div class="command-keyword">"Clear text"</div>
          <div class="command-desc">Clear current text</div>
        </div>
        <div class="command-item">
          <div class="command-keyword">"Read back"</div>
          <div class="command-desc">Read current text aloud</div>
        </div>
        <div class="command-item">
          <div class="command-keyword">"Spell check"</div>
          <div class="command-desc">Check spelling of last word</div>
        </div>
        <div class="command-item">
          <div class="command-keyword">"Change language to [lang]"</div>
          <div class="command-desc">Switch language (en, hi, te, etc.)</div>
        </div>
        <div class="command-item">
          <div class="command-keyword">"Help"</div>
          <div class="command-desc">List all commands again</div>
        </div>
      </div>
    </div>
    
    <div class="content-area">
      <div class="content-label">üìù Current Text</div>
      <div id="currentText" style="color: #666; font-style: italic;">
        Your dictated text will appear here...
      </div>
    </div>
    
    <div class="predictions-section">
      <div class="content-label">‚ú® Predictions</div>
      <div id="predictions">
        <div style="text-align: center; color: #999; padding: 20px;">
          Say "predict next words" or "complete sentence" to get suggestions
        </div>
      </div>
    </div>
    
    <div class="features">
      <div class="feature-item">
        <div class="feature-icon">üéØ</div>
        <div class="feature-title">Hands-Free</div>
        <div class="feature-desc">No typing required</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">üîä</div>
        <div class="feature-title">Audio Feedback</div>
        <div class="feature-desc">Everything is spoken aloud</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">‚ôø</div>
        <div class="feature-title">Accessible</div>
        <div class="feature-desc">Screen reader compatible</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">üåê</div>
        <div class="feature-title">Multi-language</div>
        <div class="feature-desc">Supports 6+ languages</div>
      </div>
    </div>
    <a href="/" target="_blank"><B>Switch to index Mode üé§</B></a>
    <a href="/evaluation" target="_blank"><B>Switch to Evaluation Mode üé§</B></a>
  </div>
  
  <div class="notification" id="notification"></div>
  <script>
    // ==========================================================
    // VARIABLES
    // ==========================================================
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const helpBtn = document.getElementById('helpBtn');
    const statusEl = document.getElementById('status');
    const currentTextEl = document.getElementById('currentText');
    const predictionsEl = document.getElementById('predictions');
    const voiceActivityEl = document.getElementById('voiceActivity');
    const notificationEl = document.getElementById('notification');
    
    let recognition = null;
    let currentText = "";
    let isVoiceMode = false;
    let isProcessingCommand = false;
    
    // ==========================================================
    // NOTIFICATION SYSTEM
    // ==========================================================
    function showNotification(message, type = 'info') {
      const colors = {
        info: '#3498db',
        success: '#48bb78',
        warning: '#f59e0b',
        error: '#f56565'
      };
      
      notificationEl.textContent = message;
      notificationEl.style.background = colors[type] || colors.info;
      notificationEl.style.display = 'block';
      
      setTimeout(() => {
        notificationEl.style.display = 'none';
      }, 3000);
    }
    
    // ==========================================================
    // VOICE FEEDBACK SYSTEM
    // ==========================================================
    function speakFeedback(text, rate = 0.9) {
      if ('speechSynthesis' in window) {
        // Cancel any ongoing speech
        speechSynthesis.cancel();
        
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = rate;
        utterance.pitch = 1;
        utterance.volume = 1;
        
        // Get available voices and prefer female voices for better clarity
        const voices = speechSynthesis.getVoices();
        const femaleVoice = voices.find(voice => 
          voice.name.includes('Female') || 
          voice.name.includes('Samantha') ||
          voice.name.includes('Google UK English Female')
        );
        
        if (femaleVoice) {
          utterance.voice = femaleVoice;
        }
        
        speechSynthesis.speak(utterance);
      }
    }
    
    // ==========================================================
    // SPEECH RECOGNITION INITIALIZATION
    // ==========================================================
    function initializeSpeechRecognition() {
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        statusEl.innerHTML = "‚ùå Voice recognition not supported in this browser.<br>Please use Chrome, Edge, or Safari.";
        startBtn.disabled = true;
        showNotification("Voice recognition not supported", "error");
        return null;
      }
      
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recog = new SpeechRecognition();
      recog.continuous = true;
      recog.interimResults = true;
      recog.lang = 'en-US';
      recog.maxAlternatives = 3; // Get multiple alternatives for better accuracy
      
      recog.onstart = () => {
        isVoiceMode = true;
        startBtn.disabled = true;
        stopBtn.disabled = false;
        voiceActivityEl.style.display = 'block';
        
        statusEl.innerHTML = "üé§ <strong>Listening...</strong><br>Speak naturally or use voice commands";
        speakFeedback("Voice mode activated. You can start speaking or use voice commands.");
        showNotification("Voice mode activated", "success");
      };
      
      recog.onresult = (event) => {
        voiceActivityEl.style.animation = 'pulse 0.5s infinite';
        
        let finalTranscript = '';
        let interimTranscript = '';
        let confidence = 0;
        
        for (let i = event.resultIndex; i < event.results.length; i++) {
          const transcript = event.results[i][0].transcript;
          confidence = event.results[i][0].confidence;
          
          if (event.results[i].isFinal) {
            finalTranscript += transcript + ' ';
            processCommand(transcript.trim().toLowerCase(), confidence);
          } else {
            interimTranscript += transcript;
          }
        }
        
        // Show interim results
        if (interimTranscript && !isProcessingCommand) {
          currentTextEl.innerHTML = `<span style="color: #2c3e50">${currentText}</span> <span style="color: #667eea">${interimTranscript}</span>`;
        }
        
        voiceActivityEl.style.animation = 'pulse 2s infinite';
      };
      
      recog.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
        voiceActivityEl.style.display = 'none';
        
        if (event.error === 'not-allowed') {
          statusEl.textContent = "‚ùå Microphone access denied. Please allow microphone permissions.";
          speakFeedback("Microphone access denied. Please allow permissions.");
          showNotification("Microphone access denied", "error");
        } else if (event.error === 'no-speech') {
          statusEl.textContent = "üé§ No speech detected. Try speaking louder or checking your microphone.";
        } else {
          statusEl.textContent = `‚ö† Speech recognition error: ${event.error}`;
        }
        
        resetVoiceButtons();
      };
      
      recog.onend = () => {
        isVoiceMode = false;
        voiceActivityEl.style.display = 'none';
        resetVoiceButtons();
        statusEl.textContent = "‚èπÔ∏è Voice mode stopped";
        speakFeedback("Voice mode stopped");
      };
      
      return recog;
    }
    
    function resetVoiceButtons() {
      startBtn.disabled = false;
      stopBtn.disabled = true;
    }
    
    // ==========================================================
    // COMMAND PROCESSING
    // ==========================================================
    function processCommand(command, confidence = 0.8) {
      if (!command || isProcessingCommand) return;
      
      isProcessingCommand = true;
      console.log('Processing command:', command, 'Confidence:', confidence);
      
      // Normalize command
      const normalizedCommand = command.toLowerCase().trim();
      
      // Command: Start typing / Dictation mode
      if (normalizedCommand.includes('start typing') || 
          normalizedCommand.includes('start dictation') ||
          normalizedCommand === 'typing') {
        speakFeedback("Dictation mode activated. Speak your text now.");
        statusEl.innerHTML = "üé§ <strong>Dictation Mode</strong><br>Speak your text...";
        showNotification("Dictation mode activated", "success");
      }
      
      // Command: Predict next words
      else if (normalizedCommand.includes('predict next') || 
               normalizedCommand.includes('next word') ||
               normalizedCommand.includes('suggest words')) {
        getWordPredictions();
      }
      
      // Command: Complete sentence
      else if (normalizedCommand.includes('complete sentence') || 
               normalizedCommand.includes('sentence completion') ||
               normalizedCommand.includes('finish sentence')) {
        getSentenceCompletions();
      }
      
      // Command: Clear text
      else if (normalizedCommand.includes('clear text') || 
               normalizedCommand.includes('clear all') ||
               normalizedCommand.includes('delete text')) {
        currentText = "";
        updateCurrentText();
        speakFeedback("Text cleared");
        statusEl.textContent = "üìù Text cleared";
        showNotification("Text cleared", "info");
      }
      
      // Command: Read back
      else if (normalizedCommand.includes('read back') || 
               normalizedCommand.includes('read text') ||
               normalizedCommand.includes('speak text')) {
        if (currentText.trim()) {
          speakFeedback(`Current text: ${currentText}`);
        } else {
          speakFeedback("No text to read");
        }
      }
      
      // Command: Spell check
      else if (normalizedCommand.includes('spell check') || 
               normalizedCommand.includes('check spelling') ||
               normalizedCommand.includes('correct spelling')) {
        checkSpelling();
      }
      
      // Command: Change language
      else if (normalizedCommand.includes('change language to')) {
        const langMatch = command.match(/change language to (\w+)/i);
        if (langMatch && langMatch[1]) {
          changeLanguage(langMatch[1].toLowerCase());
        }
      }
      
      // Command: Help
      else if (normalizedCommand.includes('help') || 
               normalizedCommand.includes('commands') ||
               normalizedCommand.includes('what can i say')) {
        speakHelp();
      }
      
      // Default: Treat as dictation text
      else {
        if (confidence > 0.7) { // Only accept confident results
          currentText += (currentText ? ' ' : '') + command;
          updateCurrentText();
          
          // Auto spell check for last word
          setTimeout(() => autoSpellCheckLastWord(), 500);
        }
      }
      
      setTimeout(() => {
        isProcessingCommand = false;
      }, 1000);
    }
    
    // ==========================================================
    // TEXT MANAGEMENT
    // ==========================================================
    function updateCurrentText() {
      currentTextEl.textContent = currentText || "Your dictated text will appear here...";
      currentTextEl.style.color = currentText ? '#2c3e50' : '#666';
      currentTextEl.style.fontStyle = currentText ? 'normal' : 'italic';
    }
    
    // ==========================================================
    // PREDICTION FUNCTIONS
    // ==========================================================
    async function getWordPredictions() {
      if (!currentText.trim()) {
        speakFeedback("Please speak some text first, then ask for predictions.");
        showNotification("Speak some text first", "warning");
        return;
      }
      
      try {
        statusEl.innerHTML = "‚è≥ <strong>Getting word predictions...</strong>";
        speakFeedback("Getting word predictions");
        
        const response = await fetch(`/predict?text=${encodeURIComponent(currentText)}&num_word=5&num_sentence=0`);
        const data = await response.json();
        
        if (data.word_candidates && data.word_candidates.length > 0) {
          displayPredictions(data.word_candidates, 'word');
          const predictionsText = data.word_candidates.join(', ');
          speakFeedback(`Suggested words: ${predictionsText}. Say a number to select.`);
          showNotification(`Found ${data.word_candidates.length} word suggestions`, "success");
        } else {
          predictionsEl.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">No word predictions available</div>';
          speakFeedback("No word predictions available");
        }
        
        statusEl.textContent = "‚úÖ Word predictions ready";
      } catch (error) {
        console.error('Error getting predictions:', error);
        speakFeedback("Error getting predictions");
        showNotification("Error getting predictions", "error");
      }
    }
    
    async function getSentenceCompletions() {
      if (!currentText.trim()) {
        speakFeedback("Please speak some text first, then ask for sentence completions.");
        return;
      }
      
      try {
        statusEl.innerHTML = "‚è≥ <strong>Getting sentence completions...</strong>";
        speakFeedback("Getting sentence completions");
        
        const response = await fetch(`/predict?text=${encodeURIComponent(currentText)}&num_word=0&num_sentence=3`);
        const data = await response.json();
        
        if (data.sentence_candidates && data.sentence_candidates.length > 0) {
          displayPredictions(data.sentence_candidates, 'sentence');
          const firstCompletion = data.sentence_candidates[0];
          speakFeedback(`Suggested completion: ${firstCompletion}. Say a number to select.`);
          showNotification(`Found ${data.sentence_candidates.length} sentence suggestions`, "success");
        } else {
          predictionsEl.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">No sentence completions available</div>';
          speakFeedback("No sentence completions available");
        }
        
        statusEl.textContent = "‚úÖ Sentence completions ready";
      } catch (error) {
        console.error('Error getting completions:', error);
        speakFeedback("Error getting sentence completions");
        showNotification("Error getting completions", "error");
      }
    }
    
    function displayPredictions(items, type) {
      predictionsEl.innerHTML = `
        <div class="prediction-grid">
          ${items.map((item, index) => `
            <div class="prediction-item" onclick="selectPrediction(${index + 1})" data-index="${index + 1}">
              <div class="prediction-type">${type.toUpperCase()} ${index + 1}</div>
              <div class="prediction-text">${item}</div>
            </div>
          `).join('')}
        </div>
        <div style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
          Say "select [number]" or click to choose
        </div>
      `;
    }
    
    function selectPrediction(index) {
      const predictionItem = document.querySelector(`.prediction-item[data-index="${index}"]`);
      if (predictionItem) {
        const text = predictionItem.querySelector('.prediction-text').textContent;
        currentText += (currentText.endsWith(' ') ? '' : ' ') + text + ' ';
        updateCurrentText();
        speakFeedback(`Added: ${text}`);
        showNotification(`Added suggestion ${index}`, "success");
        
        // Clear predictions after selection
        setTimeout(() => {
          predictionsEl.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Say "predict next words" or "complete sentence" for more</div>';
        }, 2000);
      }
    }
    
    // ==========================================================
    // SPELL CHECK FUNCTION
    // ==========================================================
    async function checkSpelling() {
      if (!currentText.trim()) {
        speakFeedback("No text to check");
        return;
      }
      
      const words = currentText.split(' ');
      const lastWord = words[words.length - 1];
      
      if (!lastWord || lastWord.length < 2) {
        speakFeedback("No word to spell check");
        return;
      }
      
      try {
        speakFeedback(`Checking spelling of ${lastWord}`);
        
        const response = await fetch(`/correct_word?text=${encodeURIComponent(lastWord)}&lang=en`);
        const data = await response.json();
        
        if (data.corrected && data.corrected.toLowerCase() !== lastWord.toLowerCase()) {
          currentText = currentText.substring(0, currentText.length - lastWord.length) + data.corrected;
          updateCurrentText();
          speakFeedback(`Corrected ${lastWord} to ${data.corrected}`);
          showNotification(`Corrected: ${lastWord} ‚Üí ${data.corrected}`, "success");
        } else {
          speakFeedback(`${lastWord} is spelled correctly`);
          showNotification("Spelling is correct", "info");
        }
      } catch (error) {
        console.error('Error checking spelling:', error);
        speakFeedback("Error checking spelling");
      }
    }
    
    async function autoSpellCheckLastWord() {
      if (!currentText.trim()) return;
      
      const words = currentText.split(' ');
      const lastWord = words[words.length - 1];
      
      if (!lastWord || lastWord.length < 3) return;
      
      try {
        const response = await fetch(`/correct_word?text=${encodeURIComponent(lastWord)}&lang=en`);
        const data = await response.json();
        
        if (data.corrected && data.corrected.toLowerCase() !== lastWord.toLowerCase()) {
          currentText = currentText.substring(0, currentText.length - lastWord.length) + data.corrected;
          updateCurrentText();
          speakFeedback(`Auto-corrected ${lastWord} to ${data.corrected}`);
        }
      } catch (error) {
        // Silent fail for auto-correction
      }
    }
    
    // ==========================================================
    // LANGUAGE MANAGEMENT
    // ==========================================================
    function changeLanguage(langCode) {
      if (!recognition) return;
      
      const languageMap = {
        'en': 'en-US',
        'hi': 'hi-IN',
        'te': 'te-IN',
        'ta': 'ta-IN',
        'kn': 'kn-IN',
        'fr': 'fr-FR'
      };
      
      const lang = languageMap[langCode] || 'en-US';
      recognition.lang = lang;
      
      speakFeedback(`Changed language to ${langCode}`);
      statusEl.textContent = `üåê Language changed to ${langCode.toUpperCase()}`;
      showNotification(`Language: ${langCode.toUpperCase()}`, "info");
    }
    
    // ==========================================================
    // HELP FUNCTION
    // ==========================================================
    function speakHelp() {
      const helpText = `
        You can use these voice commands:
        Say "start typing" to begin dictation.
        Say "predict next words" to get word suggestions.
        Say "complete sentence" for sentence completions.
        Say "clear text" to delete everything.
        Say "read back" to hear your text.
        Say "spell check" to check spelling.
        Say "change language to" followed by a language code like en, hi, or te.
        Say "help" anytime to hear these commands again.
      `;
      
      speakFeedback(helpText);
      showNotification("Voice commands listed", "info");
    }
    
    // ==========================================================
    // EVENT LISTENERS
    // ==========================================================
    startBtn.addEventListener('click', () => {
      if (!recognition) {
        recognition = initializeSpeechRecognition();
      }
      
      if (recognition && !isVoiceMode) {
        try {
          recognition.start();
        } catch (e) {
          console.error('Failed to start recognition:', e);
          speakFeedback("Failed to start voice recognition");
          showNotification("Failed to start voice recognition", "error");
        }
      }
    });
    
    stopBtn.addEventListener('click', () => {
      if (recognition && isVoiceMode) {
        try {
          recognition.stop();
        } catch (e) {
          console.error('Failed to stop recognition:', e);
        }
      }
    });
    
    helpBtn.addEventListener('click', () => {
      speakHelp();
    });
    
    // ==========================================================
    // INITIALIZATION
    // ==========================================================
    document.addEventListener('DOMContentLoaded', () => {
      // Load voices for speech synthesis
      if ('speechSynthesis' in window) {
        speechSynthesis.onvoiceschanged = () => {
          console.log('Voices loaded:', speechSynthesis.getVoices().length);
        };
      }
      
      // Initial greeting
      setTimeout(() => {
        speakFeedback("Welcome to Accessibility Mode. You can speak naturally or use voice commands. Say 'help' for a list of commands.");
      }, 1000);
      
      // Add keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Space to start/stop
        if (e.code === 'Space' && e.ctrlKey) {
          e.preventDefault();
          if (isVoiceMode) {
            stopBtn.click();
          } else {
            startBtn.click();
          }
        }
        
        // H for help
        if (e.code === 'KeyH' && e.ctrlKey) {
          e.preventDefault();
          speakHelp();
        }
        
        // Escape to stop
        if (e.code === 'Escape' && isVoiceMode) {
          stopBtn.click();
        }
      });
    });
    
    // Make selectPrediction available globally for onclick events
    window.selectPrediction = selectPrediction;
  </script>
</body>
</html>